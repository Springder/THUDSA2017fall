1. 所使用数据结构与算法的构思、原理和实现要点。
  堆，基于数组实现。

2. 完成过程中遇到的问题，排除问题的主要过程、使用的方法和技巧，以及参考资料。
  主要问题在于牌的翻转。我用符号的正负来模拟。一个节点有两个标记值：乘数和区间和（牌的绝对值取为1，那么正面向上牌的数量为区间长度与区间和的和的一半：
  $$
  up=\frac{sum(cards) + len(range)}{2}
  $$

  * 读入H指令时，进行更新操作`update` ：若更新区间覆盖当前区间，那么中心点乘法标记和区间和标记分别乘-1即可。如果覆盖不全：首先将乘法标记和区间和标记向下传一层（`push down`）。然后分别对左子区间和右子区间重复上述操作。完成之后左子区间和右子区间的区间和已经更新，那么再对该区间更新区间和（`push up`）
  * 读入Q指令时，进行查询操作`query` ：若更新区间覆盖当前区间，直接返回区间和再求正面向上。如果没有，则需要将本区间的标记向下传，然后分别查询左右区间，返回值加上左右区间递归调用的返回值即可。

3. 时间和空间复杂度的估算。

   更新时，每一子区间都要向下用常数时间传标记，也要用常数时间求和。因此复杂度为$O(nlogn)$。查询时，与更新类似。因此总的时间复杂度为$O(nlogn)$。空间上只有三个数组，为$O(n)$

4. （可选）介绍理论分析与实测效果的吻合程度，不吻合时进一步解释原因。

5. （可选）所用方法的特别、新颖或创新之处。